<html>
<head>
<style>
	.time {width: 200px;}
	.atticTemp, .outsideTemp {width: 200px;}
	.time, .atticTemp, .outsideTemp {float: left; background: transparent;}
	.row {clear: both; width: 600px;}
	.odd {background-color: #FFF;}
	.even {background-color: #CCC;}
	.spacer {clear: both;}
	
</style>
<script>
    // temperature data - array of {t: dateTime, atticTemp: temp, outsideTemp: temp}
	var temperatureData = {{{temperatures}}};
</script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

</head>
<body>
<div id="chart_div"></div>
<div id="options">
	<label>Show Number of Days</label><input id="numDays" /><br>
</div>
<script>

function now() {
    return new Date().getTime();
}


var timer;
$("#numDays").on("change", function(e) {
	clearTimeout(timer);
	drawChart(+this.value);
}).on("input", function(e) {
	// short pause before processing
	clearTimeout(timer);
	var self = this;
	timer = setTimeout(function() {
		drawChart(+self.value);
	}, 500);
});

// convert degrees Celsius to Fahrenheit (rounded to 1 decimal point)
function toFahrenheit(c) {
    return Math.round(((c * 9 / 5) + 32) * 10) / 10;
}

var useFahrenheit = $.cookie("temperatureUnits") === "F";

google.load("visualization", "1", {packages:["corechart"]});
google.setOnLoadCallback(function() {
	drawChart();
});

function drawChartGetDays() {
	drawChart(+$("#numDays").val());
}

function drawChart(days) {
	var timeLimit;
	
	days = days || 0;
	days = Math.min(days, 0);
	if (days) {
		timeLimit = now() - ((24 * 60 * 60 * 1000) * days);
	} else {
		timeLimit = 0;
	}
	var data = new google.visualization.DataTable();
	data.addColumn('datetime', 'time', 'time');
	data.addColumn('number', 'attic', 'attic');
	data.addColumn('number', 'outside', 'outside');
	var item;
	for (var i = 0, len = temperatureData.length; i < len; i++) {
		item = temperatureData[i];
		if (item.t > timeLimit) {
			if (!useFahrenheit) {
				data.addRow([new Date(item.t), item.atticTemp, item.outsideTemp]);
			} else {
				data.addRow([new Date(item.t), toFahrenheit(item.atticTemp), toFahrenheit(item.outsideTemp)]);
			}
		}
	}

	var options = {
	  title: 'Temperatures',
	  curveType: 'function',
	  height: 500,
	  lineWidth: 1,
	  legend: {position: 'bottom'}
	};

	var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

	chart.draw(data, options);
}
$(window).resize(drawChartGetDays);

// reload the page every 10 minutes
setTimeout(function() {
	window.location.reload(true);
}, 10 * 60 * 1000);
</script>	
</body>
</html>